<?php

namespace Admin\Controller;
namespace Admin\Controller;
use Admin\Common\Api\Api;
class BrandController extends BaseController {
    private static $api_url = "http://chenkuanxin.catalog.com";
    //获取品牌列表
    public function searchBrandList() {
        $url = self::$api_url."/Brand/searchBrandList";
        if(I("param.")){
            $param = array();
            if(session("brand_search_list")){
               $param = array_merge(session("brand_search_list"),I("param."));
            }else{
               $param = I("param.");
               session("brand_search_list",$param); 
            }
            foreach($param as $key=>$val){
                if($val == ""){
                    unset($param[$key]);
                }
            }
            $param = !empty($param) ? $param : array();
            $brandlist = Api::request($url,$param);
            $this->assign("searchVal",$param);
        }else{
            session('cms_search_page',null);
            $brandlist = Api::request($url);
        }
        if($brandlist[0]){
            $Page = new \Think\Page($brandlist[0]["count"],10);
            $show = $Page->show();
            $this->assign('page',$show);
        }        
        $this->assign("brandlist",$brandlist[0]);
        $this->display();
     }
     //添加品牌
     public function addBrand(){
        $check = array("name","priority");
        $flag = 1;
        $error = "";
        foreach($check as $key=>$val){
            if(!I("param.".$val)){
                $flag = 0;
                $error .= $val."不能为空 ";
            }
        }
        if($flag){
            if(I("param.")){
                $url = self::$api_url."/Brand/addBrand";
                $result = Api::request($url,I("param."),"post");
                if($result[0]["result"] == 1){
                    $this->success("添加成功！");exit;
                }
            } 
        }else{
            $this->error($error);exit;
        }
    }
    //编辑品牌
     public function modifyBrand(){
        if(I("param.dotype")){
            $url = self::$api_url."/Brand/searchBrandDetail";
            $list = Api::request($url,array("brand_id"=>I("param.brand_id")));
            if($list[0]["result"] == 1){
                $this->assign("list",$list[0]["data"]);
                $this->show();exit;
            }else{
                echo "<font color='red'>".$list[0]["dis"]."</font>";exit;
            }    
        }else{
            $url = self::$api_url."/Brand/modifyBrand";
            $check = array("name","priority","brand_id");
            $flag = 1;
            $error = "";
            foreach($check as $key=>$val){
                if(!I("param.".$val)){
                    $flag = 0;
                    $error .= $val."不能为空 ";
                }
            }
            if($flag){
                $result = Api::request($url,I("param."));
                if($result[0]["result"] == 1){
                    $this->success("编辑成功");exit;
                }
                $this->error($result[0]["dis"]);exit;
            }else{
                $this->error($error);exit;
            }
        } 
    }
    //删除品牌
    function deleteBrand(){
        if(I("param.brand_id")){
            $data["brand_id"] = I("param.brand_id");
            $url = self::$api_url."/Brand/deleteBrand";
            $result = Api::request($url,$data);
            echo json_encode($result[0]);exit;
        }else{
             $this->success("brand_id为空或者不存在");exit;
        }
    }
}
