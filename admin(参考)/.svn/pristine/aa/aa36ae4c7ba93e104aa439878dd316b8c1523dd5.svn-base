<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:wb="http://open.weibo.com/wb">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title></title>
        <link href="__PUBLIC__/css/common.css" rel="stylesheet" type="text/css"/>
        <link href="__PUBLIC__/css/ui-dialog.css" rel="stylesheet" type="text/css"/>
    </head>
    <style>
        .ui-dialog-autofocus{ display:none;}
    </style>
    <body>
        <div class="nav">当前页面：标签管理 》 标签列表</div>
        <div class="list_title">
            标签列表  （共有<span id="category_count" class="color_red">{$taglist.count}</span>条数据） <input id="butAddTag" type="button" value="添加标签" class="hand_style" >
        </div>
        <hr/>
        <div style="margin:20px 0;">
            <h3>标签查询</h3>
            <div style="margin:20px 0;">
                <form action="/Tag/searchTagList" method="post">
                    标签编码：<input type="text" name="tag_id" value="{$searchVal.tag_id}"> &nbsp;标签名称 <input type="text" name="name" value="{$searchVal.name}"/><br/><br/>
                        标签类型：<select name="type">
                            <option value="">请选择</option>
                            <option value="1" <if condition="$searchVal.type eq 1">selected="selected"</if>>健康标签</option>
                            <option value="2" <if condition="$searchVal.type eq 2">selected="selected"</if>>安心度标签</option>
                            <option value="3" <if condition="$searchVal.type eq 3">selected="selected"</if>>敏感人群标签</option>
                            <option value="4" <if condition="$searchVal.type eq 4">selected="selected"</if>>促销标签</option>
                        </select><br/><br/>
                        <input type="submit" value="查询" style="margin-left:60px;" /> <input type="reset" value="清空" />
                </form>
            </div>
        </div>
         <hr/>
        <div>
        <table class="gridtable">
            <THEAD> 
                <TR> 
                    <th width="10%">标签ID</th>
                    <th width="25%">标签类型</th>
                    <th width="25%">标签名称</th>
                    <th width="25%">标签icon</th>
                    <th width="20%">操作</th>
                </TR> 
            </THEAD> 
            <TBODY>
               <foreach name="taglist.data" key="k" item="list">
                   <tr align="center" id="Tag_{$list.tag_id}">
                       <td>{$list.tag_id}</td>
                       <td><foreach name="tag_type" key="kk" item="type"><eq name="kk" value="$list.type">{$type}</eq></foreach></td>
                       <td>{$list.name}</td>
                       <td><if condition="$list.pic_url neq '' "><img src="{$list.pic_url}" width="20px" height="20px"></if></td>
                       <td><a href="javascript:void(0);" onclick="editTag({$list.tag_id})"  />编辑</a>&nbsp;
                           <a href="javascript:void(0);" onclick="deleteTag({$list.tag_id})"  />删除</a>
                       </td>
                   </tr>
               </foreach>
            </TBODY>
        </table>
         </div>
         <div class="pagelist">{$page}</div>
         <!--添加标签-->
         <div id="addTagHtml" class="hide">
             <form action="/Tag/addTag" method="post" enctype="multipart/form-data">
                 <table width="100%" align="center" height="130">
                     <tr >
                         <td align="right" height="50px;">标签类型:</td>
                         <td><select name="type">
                            <option value="">请选择</option>
                            <option value="1">健康标签</option>
                            <option value="2">安心度标签</option>
                            <option value="3">敏感人群标签</option>
                            <option value="4">促销标签</option>
                        </select></td>
                     </tr>
                     <tr >
                         <td align="right" height="50px;">标签名称:</td>
                         <td><input type="text" name="name"></td>
                     </tr>
                     <tr>
                         <td align="right">标签顺序:</td>
                         <td><input type="text" name="priority" onblur="check_priority(this)">&nbsp;<font color="red">* 顺序必须为数字</font></td>
                     </tr>
                     <tr>
                         <td align="right" height="50px;">标签icon:</td>
                         <td><input type="file" name="pic_url"></td>
                     </tr>
                     <tr>
                         <td></td><td><input type="submit" value="提交"><input type="reset" value="重置"></td>
                     </tr>
                 </table>
             </form>
         </div>
        <script  src="__PUBLIC__/js/jquery-1.9.1.min.js" type="text/javascript"></script>       
        <script src="__PUBLIC__/js/dialog-min-admin.js"></script>
        <script>
            $(function () {
                //添加标签
                $("#butAddTag").bind("click",function(){
                    var add_dept=dialog({
                        title: '添加标签',
                        content: $('#addTagHtml').html(),
                        width:480,
                        ok:function(){
                        doAddPage();
                        }
                        });
                        add_dept.show();
                });
            });
            //顺序验证
            function check_priority(obj){
                var val =   $(obj).val();
                var regExp=/^\d+(\.\d+)?$/;
                if(!regExp .test (val )){
                    alert("排序必须为整数数字");
                    $(obj).val("");return;
                }
            }
            //编辑标签
            function editTag(tag_id){
                 $.ajax({
                    type: 'get',
                    dataType: 'html',
                    url: "/Tag/modifyTag",
                    data: {"tag_id":tag_id,"dotype":"edit"},
                    success: function (returnData) {
                        if(returnData){
                            var edit_dept=dialog({
                                title: '编辑标签',
                                content: returnData,
                                width:480
                            });
                            edit_dept.show();return;
                        }                            
                    }
                });
            }
            //删除标签
            function deleteTag(tag_id){
                $.ajax({
                    type: 'get',
                    url: "/Tag/deleteTag",
                    dataType: 'json',
                    data: {"tag_id":tag_id},
                    success: function (data) {
                        if(data.result == 1){
                            alert(data.dis);
                            $("#Tag_"+tag_id).remove();return;
                        }else{
                            alert(data.dis);return;
                        }
                     }
                 });
            }
            
        </script>
    </body>
</html>
